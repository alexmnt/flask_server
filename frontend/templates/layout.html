<!doctype html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title or "Flask + MD3" }}</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400;500"
      rel="stylesheet"
    />

    {{ vite_css('src/main.ts') }}

    <script>
      (() => {
        const root = document.documentElement;
        let shownAt = 0;
        const minVisible = 360;

        const show = () => {
          if (root.dataset.pageLoading === "true") {
            return;
          }
          root.dataset.pageLoading = "true";
          shownAt = performance.now();
        };

        const hide = () => {
          if (root.dataset.pageLoading !== "true") {
            return;
          }
          const elapsed = performance.now() - shownAt;
          const remaining = Math.max(minVisible - elapsed, 0);
          window.setTimeout(() => {
            delete root.dataset.pageLoading;
          }, remaining);
        };

        window.pageLoader = { show, hide };

        let hasIntent = false;
        try {
          hasIntent = sessionStorage.getItem("page-loader-intent") === "1";
          if (hasIntent) {
            sessionStorage.removeItem("page-loader-intent");
            show();
          }
        } catch {
          hasIntent = false;
        }

        const timer = window.setTimeout(() => {
          if (!hasIntent && document.readyState !== "complete") {
            show();
          }
        }, 260);

        window.addEventListener(
          "load",
          () => {
            window.clearTimeout(timer);
            hide();
          },
          { once: true }
        );

        window.addEventListener("pageshow", () => {
          hide();
        });
      })();
    </script>
  </head>

  <body class="min-h-screen">
    <div class="page-loader" role="status" aria-live="polite">
      <div class="page-loader__stack">
        <div class="page-loader__halo" aria-hidden="true"></div>
        <div class="page-loader__orbit" aria-hidden="true"></div>
        <div class="page-loader__core" aria-hidden="true"></div>
        <div class="page-loader__text">
          <span class="page-loader__title">Loading workspace</span>
          <span class="page-loader__subtitle">Syncing modules and assets</span>
        </div>
      </div>
    </div>

    <div class="topstack">
      <header class="topbar">
        <div class="container mx-auto flex flex-col items-start gap-4 px-4 py-3.5 md:flex-row md:flex-wrap md:items-center md:justify-between md:px-6">
          <div class="brand flex items-center gap-3">
            <div class="brand-badge" aria-hidden="true">PHI</div>
            <div class="brand-text flex flex-col gap-0.5">
              <span class="md-typescale-title-large">{{ brand_name or "Placeholder Tool" }}</span>
              <span class="md-typescale-label-medium">
                {{ brand_tagline or "Place Holder" }}
              </span>
            </div>
          </div>

          <div class="actions flex flex-wrap items-center gap-3 w-full md:w-auto md:justify-end">
            {% block topbar_actions %}
              <div class="user-chip flex items-center gap-2.5" aria-label="Signed in with Entra ID">
                <span class="user-avatar">MA</span>
                <div class="user-info flex flex-col gap-0.5">
                  <span class="user-name">Munteanu, Alexandru</span>
                  <span class="user-meta inline-flex items-center gap-1.5">
                    <span class="entra-logo">E</span>
                    Auto login (Entra ID)
                  </span>
                </div>
              </div>
            {% endblock %}
            {% include "partials/asset_health.html" %}
            <md-icon-button aria-label="Toggle theme" onclick="toggleTheme()">
              <span class="material-symbols-outlined">dark_mode</span>
            </md-icon-button>
          </div>
        </div>
      </header>

      <div class="menu-shell container mx-auto px-4 pb-4 md:px-6">
        {% block subnav %}
          {% include "partials/menu_grid.html" %}
        {% endblock %}
      </div>
    </div>

    <main class="main-content container mx-auto flex flex-col gap-5 px-4 pb-5 md:px-6">
      {% block content %}{% endblock %}
    </main>

    <footer class="footer md-typescale-body-small px-4 py-6 text-center md:px-5">
      Built with Flask â€¢ Material Design 3-ish UI via Material Web Components
    </footer>
    <button
      class="menu-drawer__fab"
      type="button"
      data-menu-reopen
      aria-controls="menu-grid"
      aria-expanded="false"
      aria-hidden="true"
    >
      <span class="material-symbols-outlined" aria-hidden="true">apps</span>
      <span>Menu</span>
    </button>
    {{ vite_js('src/main.ts') }}
  </body>
</html>
